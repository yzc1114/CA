# 复习 CA 恶心死了呜呜呜呜

## 第一章呗

### Amdahl定律
加速比 =  总执行时间(改进前）/ 总执行时间（改进后）

系统加速比 =  1 / （（1 - 可改进比例） + 可改进比例 / 部件加速比））

### CPU性能公式

- CPI 平均每条指令时钟周期数
- IC 指令数量
- 时钟周期时间

**CPU时间 = IC * CPI * 时钟周期时间**

### 冯诺依曼结构
运算器，控制器，存储器，输入设备，输出设备

### 提高并行性的途径
1. 时间重叠
2. 资源重复
3. 资源共享

## 第二章啊

### 四种指令集结构
1. 堆栈结构
2. 累加器结构
3. 通用寄存器结构（一个寄存器， 一个memory）
4. 通用寄存器结构（两个寄存器）

### 对指令集基本要求
**完整性、规整性、高效性、兼容性**

### CISC RISC

### MIPS
1. I类指令
	- rs, rt, 立即数
	- load,store,立即数指令,分支指令,寄存器跳转
2. R类指令
	- rs, rt, rd
	- ALU指令
3. J类指令
	- 偏移量
	- 跳转指令

## 第三章了

### 瓶颈？
时间最长的段

### 流水线分类
1. 单功能流水线 多功能流水线
	1. 单功能 只能完成一种功能的流水线
	2. 多功能 通过不同的连接可以实现多种功能

2. 静态 动态 流水线
	1. 静态： 同一时间内，流水线的各段连接方式不能改变
	2. 动态： 同一时间内，流水线的各段连接方式可以不同，例如可以同时做加和乘

3. 部件级、处理机级、处理机间流水线
	1. 部件级： 运算操作内部流水
	2. 处理机级：我们最常用的，指令分过程的流水
	3. 处理机间：EZ

4. 线性流水线 非线性流水线
	1. 线性：没有反馈回路
	2. 非线性：有

5. 顺序流水线，乱序流水线
	1. 顺序：流出顺序与流入相同
	2. 乱序：不同

### 吞吐率
1. n 为任务数量
2. Tk 为处理完这n个任务的时间

**TP = n / Tk**

### 效率
实心 / 总共的块

### 加速比
加速前 / 加速后

### 解决瓶颈问题！！！
1. 细分瓶颈段
2. 重复设置瓶颈段

### 性能分析
- 看书！！！例题！！！
- 最最重要，记得数据流入前，先看看这个数据有没有被算出来。
- 多走点脑子。

### 相关！种类
1. 数据相关
	写后读！ 具有传递性
2. 名相关
	1. 反相关
	读后写
	2. 输出相关
	写后写
3. 控制相关

### 冲突种类
1. 结构冲突
	硬件资源满足不了需要
2. 数据冲突
	需要用到前面的执行结果
3. 控制冲突
	遇到分支指令的冲突

### 数据冲突解决方法
1. 定向！ 定向不了再stall。
2. 依靠编译器，重新组织指令。

### 控制冲突解决方法
1. 冻结 或 排空。 就是停止
2. 预测分支失败 或 成功
3. 延迟分支 == 延迟槽。
	1. 从前调度，最稳妥
	2. 从目标处调度
	3. 从失败处调度

## 第四章真的难

### Tomasulo
- **基本思想：通过寄存器换名来消除读后写和写后写冲突**
- 指令执行分成：流出 执行 写结果。
- 可以乱序完成。
1. 保留站
	- 在每个运算部件的入口，每个保留站保存一条已经流出并等待本功能部件执行的指令。
	- 结构： 名称 Busy Op Vj Vk Qj Qk A
	1. Vj, Vk : 左右操作数，存放实际结果。
	2. Qj, Qk : 保留站号， 若为0则代表结果已在Vj, Vk中有了
	3. A : 仅load， store命令有这个，开始时存放立即数字段，地址被算出后存放有效地址。

2. CDB 数据总线

3. 浮点寄存器 FP

4. 寄存器状态表 Qi
	每个寄存器在该表中都有对应的一项，存放应该存入这个寄存器的数据来源，即保留站号。

### 动态分支预测
1. 分支历史表 BHT
2. 分支目标缓冲器 BTB
3. **ROB**
	- **在指令确认时，若是分支指令，如果是预测错的分支指令，则表示前瞻执行有错，需要清空ROB，并从另外的分支开始执行**
	- 一旦指令得到确认，该ROB项被释放。
	- 使用队列来管理ROB，有一个头部和尾部。 HEAD和TAIL，HEAD指向最早流出的项，TAIL指向最近的空项。
	- 加强的Tomasulo
	- 只能顺序完成
	- 将指令执行分为：流出 执行 写结果 确认
	1. 保留站结构： 名称 Busy Op Vj Vk Qj Qk Dest A
		- Dest：该指令的源头ROB号。
		- Qj，Qk：存储ROB号，若为0则数据已经在Vj，Vk中算出了。
	2. ROB存储什么
		- 编号 Busy 指令内容 状态 目的 Value
		1. 状态：流出 执行 写结果 确认（已确认的项，就不是Busy的项了）
		2. 目的：要写入的目标寄存器号
		3. Value：要写入的数据内容，若没算出来则为空。
	3. 寄存器状态表
		存储的内容变成了ROB编号。

### 多指令流出技术
1. 超标量
	- 每个时钟周期流出的指令条数不固定。有个上限为n，叫n-流出。
2. 超长指令字 VLIW
	- 每个时钟周期流出指令数量固定。
	- 构成一个长指令或指令包
	- 缺点
		1. 程序代码长度增加
		2. 锁步机制
		3. 机器代码不兼容性
3. 超流水线处理机
	- 把每个流水段进一步细分。

### 循环展开和指令调度
- **比较重要**
- 看课后题，必须看懂。
- 注意：**每次都减或加同样的数，这种运算，在循环展开后，只做一次，在最后。**
- 注意：**循环展开，是通过使用不同的寄存器，以及提前将常数结果运算好来实现的。**
- 书上的注意：
	1. 保证正确性
	2. 注意有效性
	3. 使用不同的寄存器
	4. 删除多余的测试指令和分支指令
	5. 注意对存储器数据的相关性分析
	6. 注意新的相关性

## 第五章真的多 恶心

### 命中率
找到信息的概率

### 平均访存时间Ta
- 命中时，访问时间为T1。 T1称为命中时间
- 不命中时，不命中开销为 Tm = T2 + Tb
- 其中Tm为从向M2发出访问请求到把数据块调入M1所需的时间
设命中概率为H，则Ta = H * T1 +  (1 - H) * (T1 + Tm)

### Cache-主存 主存-辅存
区别看书

### Cache基本结构和原理
- 主存地址被分割成 块地址 和 块内位移
- 其中块地址用来查找该块在Cache中的位置

### 映像规则
1. 全联结映像
2. 直接映像 （1-路组相联）
3. 组相联映像

### 查找方法
- 块地址被分为 标识 和 索引
- 标识 即 用于组内区分的标识
- 索引 即 组号
- Cache中有一个目录表，用于指出当前块存放的信息是在哪个主存块中的。
- 实际记录了主存的块地址的高位部分，即标识
- 访问某块时，查找对应标识即能知道是否在Cache中存储相应块
- 访问某块： **自己理解：用索引去找到该组，在该组中并行查找标识，是否能对应上**
1. 相联存储器并行查找
2. 4路组相联并行查找

### Cache容量
等于 = 2 ** 组数 * 相联度 * 块大小
组数 即 索引大小

### 替换算法
1. 随机
2. FIFO
3. LRU
	- 实现使用堆栈法

### 写策略
1. 写直达
2. 写回法
	- 被替换时，才写回下一级

### Cache性能分析
**重点啊卧槽**
- 平均访存时间 = 命中时间 + 不命中率 * 不命中开销
- CPU时间 = IC * (CPI + 平均每条指令访存次数 * 不命中率 * 不命中开销) * 时钟周期时间

### 三种不命中
1. 强制性不命中
	第一次访问，该块不在Cache中
2. 容量不命中
	某些块被替换后，又重新被访问
3. 冲突不命中
	组相联或直接映像中，若太多块被映像到同一组，则会出现改组中某块被别的块替换，然后又被重新访问。
- 相联度越高，冲突不命中越低
- 强制性不命中和容量不命中不受相联度的映像
- 强制性不命中不受Cache容量的影响，但容量不命中随Cache容量增大而减少

### 各种方法
背书吧老弟

## 第六章吧

### RAID 廉价冗余磁盘阵列
- RAID 0 非冗余磁盘阵列
- RAID 1 磁盘镜像
- RAID 2 冗余盘是hamming码
- RAID 3 位交叉奇偶校验磁盘阵列
- RAID 4 块交叉奇偶校验磁盘阵列
- RAID 5 块交叉分布奇偶校验磁盘阵列
- RAID 6 P+Q双校验磁盘阵列
- RAID 01 10 先条带，后镜像 versus 先镜像，后条带

### 通道
1. 字节多路通道，适用于低速设备
2. 选择通道，适用于多个高速设备
3. 数组多路通道，适用于高速设备

### 虚拟DMA
允许DMA设备直接使用虚拟地址，并在DMA传送的过程中由硬件将虚拟地址转换为物理地址

## 第八章啊
背图 背图 背图
